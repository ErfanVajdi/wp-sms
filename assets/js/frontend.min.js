(()=>{jQuery(document).ready((function(){e.init(),jQuery(".wpsms-sendSmsForm").each((function(){s.init(this)}))}));var e={init:function(){this.info=Array(),this.setFields(),this.setEventListener()},getGroupId:function(e){for(var s=[],i=e.find('input[name="group_id_checkbox"]'),t=e.find('select[name="group_id_select"]'),n=0;n<i.length;++n)i[n].checked&&s.push(i[n].value);if(t&&t.val()&&s.push(t.val()),s.length)return s},setFields:function(){this.wpSmsGdprCheckbox=jQuery(".js-wpSmsGdprConfirmation"),this.wpSmsEventType=jQuery(".js-wpSmsSubscribeType"),this.wpSmsSubmitTypeButton=jQuery(".js-wpSmsSubmitTypeButton"),this.mandatoryVerify=jQuery(".js-wpSmsMandatoryVerify").val()},sendSubscriptionForm:function(e){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this,i=e.children().find(".js-wpSmsSubmitButton"),t=e.children().find(".js-wpSmsSubscribeMessage"),n=e.children().find(".js-wpSmsSubscribeOverlay"),r=e.children().find(".js-wpSmsSubscribeStepOne"),a=e.children().find(".js-wpSmsSubmitButton"),o=e.children().find(".js-wpSmsSubscribeStepTwo"),u=e.children().find(".js-wpSmsSubscriberCustomFields"),d=e.children().find(".js-wpSmsSubscriberMobile");console.log(d),console.log(e.children().find(".js-wpSmsSubscriberMobile input")),console.log(e.children().find(".js-wpSmsSubscriberMobile input.wp-sms-input-mobile").val()),i.prop("disabled",!0),t.hide(),n.css("display","flex");var p={name:e.children().find(".js-wpSmsSubscriberName input").val(),mobile:"",group_id:this.getGroupId(e),type:e.children().find(".js-wpSmsSubscribeType:checked").val()};if(d.find(".iti--show-flags").length>0){var l=document.querySelector(".iti__selected-dial-code").innerHTML;p.mobile=(l+e.children().find(".js-wpSmsSubscriberMobile input.wp-sms-input-mobile").val()).replace(/[-\s]/g,"")}else p.mobile=e.children().find(".js-wpSmsSubscriberMobile input").val();if(u.length){var c={};u.each((function(e,s){var i=jQuery(s).data("field-name"),t=jQuery(s).find("input").val();c[i]=t})),p.custom_fields=c}if(e.ajaxStart((function(){i.attr("disabled","disabled"),i.text(wpsms_ajax_object.loading_text)})),e.ajaxComplete((function(){i.prop("disabled",!0),i.text(wpsms_ajax_object.subscribe_text)})),"subscribe"===p.type)var m=wpsms_ajax_object.newsletter_endpoint_url;else m=wpsms_ajax_object.newsletter_endpoint_url+"/unsubscribe";var S=jQuery.ajax({type:"POST",url:m,contentType:"application/json",data:JSON.stringify(p)});S.fail((function(e){var s=JSON.parse(e.responseText),r=null;i.prop("disabled",!1),n.css("display","none"),void 0!==s.error&&null!==s.error?r=s.error.message:null!==s.data.status?Object.keys(s.data.params).forEach((function(e){r=s.data.params[e]})):r=wpsms_ajax_object.unknown_error,t.fadeIn(),t.html('<span class="wpsms-subscribe__message wpsms-subscribe__message--error">'+r+"</div>")})),S.done((function(e){var u=e.message;i.prop("disabled",!1),n.css("display","none"),t.fadeIn(),r.hide(),t.html('<span class="wpsms-subscribe__message wpsms-subscribe__message--success">'+u+"</div>"),"subscribe"===p.type&&"1"===s.mandatoryVerify&&(a.prop("disabled",!0),o.show())})),s.info=p},sendActivationCode:function(e){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this,i=e.children().find(".js-wpSmsActivationButton"),t=e.parents(".js-wpSmsSubscribeFormContainer"),n=e.children().find(".js-wpSmsSubscribeMessage"),r=e.children().find(".js-wpSmsSubscribeOverlay"),a=e.children().find(".js-wpSmsSubscribeStepTwo");i.prop("disabled",!0),n.hide(),r.css("display","flex"),s.info.activation=e.children().find(".js-wpSmsActivationCode").val(),t.ajaxStart((function(){i.prop("disabled",!0),i.text(wpsms_ajax_object.loading_text)})),t.ajaxComplete((function(){i.prop("disabled",!1),i.text(wpsms_ajax_object.activation_text)}));var o=jQuery.ajax({type:"POST",url:wpsms_ajax_object.newsletter_endpoint_url+"/verify",contentType:"application/json",data:JSON.stringify(s.info)});o.fail((function(e){var s=JSON.parse(e.responseText),t=null;i.prop("disabled",!1),r.css("display","none"),t=void 0!==s.error&&null!==s.error?s.error.message:wpsms_ajax_object.unknown_error,n.fadeIn(),n.html('<span class="wpsms-subscribe__message wpsms-subscribe__message--error">'+t+"</div>")})),o.done((function(e){var s=e.message;i.prop("disabled",!1),r.css("display","none"),n.fadeIn(),a.hide(),n.html('<span class="wpsms-subscribe__message wpsms-subscribe__message--success">'+s+"</div>")}))},setEventListener:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;this.wpSmsGdprCheckbox.on("change",(function(){this.checked?jQuery(this).parents(".js-wpSmsSubscribeFormField").nextAll(".js-wpSmsSubmitButton").first().prop("disabled",!1):jQuery(this).parents(".js-wpSmsSubscribeFormField").nextAll(".js-wpSmsSubmitButton").first().prop("disabled",!0)})),this.wpSmsEventType.on("click",(function(){jQuery(this).parents(".js-wpSmsSubscribeFormField").nextAll(".js-wpSmsSubmitButton").first().text(jQuery(this).data("label"))})),this.wpSmsSubmitTypeButton.on("click",(function(s){s.preventDefault(),jQuery(this).hasClass("js-wpSmsSubmitButton")&&e.sendSubscriptionForm(jQuery(this).parents(".js-wpSmsSubscribeForm")),jQuery(this).hasClass("js-wpSmsActivationButton")&&e.sendActivationCode(jQuery(this).parents(".js-wpSmsSubscribeForm"))}))}},s={init:function(e){e=jQuery(e),this.setSendSmsBlockFields(e)},setSendSmsBlockFields:function(e){SBSubscriberGroup=e.find("input[name=subscriberGroup]"),SBSubmit=e.find("input[type=submit]"),SBMessage=e.find("textarea.wpsms-sendSmsForm__messageField"),SBReceiver=e.find("input[name=receiver]"),SBPhoneNumber=e.find("input.wpsms-sendSmsForm__receiverField"),SBMessageAlert=e.find("p.wpsms-sendSmsForm__messageField__alert"),SBResult=e.find("div.wpsms-sendSmsForm__resultMessage"),SBOverlay=e.find("div.wpsms-sendSmsForm__overlay"),SBMaxCount=SBMessage.data("max");var s={SBSubscriberGroup,SBSubmit,SBMessage,SBReceiver,SBPhoneNumber,SBMessageAlert,SBResult,SBOverlay,SBMaxCount};this.setSendSmsBlockEventListeners(s)},setSendSmsBlockEventListeners:function(e){jQuery(e.SBSubmit).on("click",(function(s){s.preventDefault();var i=new FormData;i.append("sender",wpsms_ajax_object.sender),i.append("recipients",e.SBReceiver.val()),i.append("message",e.SBMessage.val()),i.append("group_ids",e.SBSubscriberGroup.val()),i.append("numbers",e.SBPhoneNumber.val()),i.append("maxCount",e.SBMaxCount),jQuery.ajax({url:wpsms_ajax_object.front_sms_endpoint_url,method:"POST",contentType:!1,cache:!1,processData:!1,data:i,beforeSend:function(){jQuery(e.SBResult).text("").fadeOut().removeClass("failed success"),jQuery(e.SBOverlay).fadeIn()},success:function(s,i,t){jQuery(e.SBResult).text(s.data).fadeIn().addClass("success"),jQuery(e.SBMessage).val("").trigger("input"),jQuery(e.SBOverlay).fadeOut()},error:function(s,i,t){var n;jQuery(e.SBResult).text(null!==(n=s.responseJSON.data)&&void 0!==n&&n.message?s.responseJSON.data.message:s.responseJSON.data).fadeIn().addClass("failed"),jQuery(e.SBOverlay).fadeOut()}})})),jQuery(e.SBMessage).on("input",(function(){var s=jQuery(this).val().length,i=e.SBMaxCount-s;s>=e.SBMaxCount-8?(jQuery(e.SBMessageAlert).fadeIn(),jQuery(e.SBMessageAlert).find("span").text(i)):jQuery(e.SBMessageAlert).fadeOut()}))}}})();